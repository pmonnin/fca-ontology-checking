# Detailed documentation of the Lattice Annotator program

## Purpose

This programs annotates a lattice generated by SOFIA with ontology classes. Statistics are computed 
on the annotation process.

## Execution

This program can be executed with:

```bash
python latticeAnnotator.py configuration lattice output statistics
```

with:

* _configuration_: JSON file containing the necessary configuration parameters
* _lattice_: SOFIA lattice to annotate
* _output_: File where the annotated SOFIA lattice will be stored
* _statistics_: File where the statistics of the annotation will be stored

## Configuration

A JSON file is used to configure this program:

```json
{
  "server-address": "http://127.0.0.1/sparql",
  "url-json-conf-attribute": "format",
  "url-json-conf-value": "application/sparql-results+json",
  "url-default-graph-attribute": "default-graph-uri",
  "url-default-graph-value": "http://dbpedia.org",
  "timeout": 20000,
  "url-query-attribute": "query",
  "type-predicate": "rdf:type",
  "parent-predicate": "rdfs:subClassOf",
  "query-prefix": "",
  "ontology-base-uri": "http://dbpedia.org/ontology/",
  "reduce-lattice": false
}
```

with:

* _server-address_: address of the SPARQL endpoint to query
* _url-json-conf-attribute_: URL attribute to use to get JSON results
* _url-json-conf-value_: value of the _url-json-conf-attribute_ to get JSON results
* _url-default-graph-attribute_: URL attribute to use to define the default graph
* _url-default-graph-value_: value of _url-default-graph-attribute_ to define the default graph
* _timeout_: timeout value for HTTP requests
* _url-query-attribute_: URL attribute to use to define the query
* _type-predicate_: predicate used to type subjects in extents with ontology classes in RDF triples -- see next paragraphs
* _parent-predicate_: predicate used to express _subClassOf_ relationships in the ontology -- see next paragraphs
* _query-prefix_: prefix of the query used during the annotation -- see next paragraphs
* _ontology-base-uri_: base URI of the ontology -- see next paragraphs
* _reduce-lattice_: boolean indicating whether the annotated lattice should be reduced to concepts with a non-empty 
proper annotation. This corresponds to the induced order on annotations.


## SPARQL queries

Below are the SPARQL queries used in the Python scripts. The use of configuration parameters is highlighted 
with ``("parameter_used")``.

### Selection of the ontology classes associated with all the (formal) objects of the lattice 

For each object_uri appearing in the extents of the formal concepts of the lattice:

```sparql
("query-prefix")

select distinct ?class where { 
    <object_uri> ("type-predicate")/("parent-predicate")* ?class . 
    FILTER(REGEX(STR(?class), "(ontology-base-uri)", "i")) .
}
```

### Relationships between classes

For each class_uri in the ontology

```sparql
("query-prefix")

select distinct ?parent where { 
    <class_uri> ("parent-predicate") ?parent . 
    FILTER(REGEX(STR(?parent), "(ontology-base-uri)", "i")) . 
}
```
