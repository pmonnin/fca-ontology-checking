# Detailed documentation of the Lattice Annotator program

## Purpose

This programs annotates a lattice generated by SOFIA, extracts subsumption axioms from it and compare the extracted 
axioms with existing axioms in the ontology. Statistics are computed on the associated ontology and the extracted 
axioms.

## Configuration

[A configuration example is available](../examples/conf-lattice-annotation.json). It contains:

```json
{
  "server-address": "http://127.0.0.1/sparql",
  "url-json-conf-attribute": "format",
  "url-json-conf-value": "application/sparql-results+json",
  "url-default-graph-attribute": "default-graph-uri",
  "url-default-graph-value": "http://dbpedia.org",
  "timeout": 20000,
  "url-query-attribute": "query",
  "type-predicate": "rdf:type",
  "parent-predicate": "rdfs:subClassOf",
  "query-prefix": "",
  "ontology-base-uri": "",
  "reduce-lattice": false
}
```

with:

* _server-address_: address of the SPARQL endpoint to query
* _url-json-conf-attribute_: URL attribute to use to get JSON results
* _url-json-conf-value_: value of the _url-json-conf-attribute_ to get JSON results
* _url-default-graph-attribute_: URL attribute to use to define the default graph
* _url-default-graph-value_: value of _url-default-graph-attribute_ to define the default graph
* _timeout_: timeout value for HTTP requests
* _url-query-attribute_: URL attribute to use to define the query
* _type-predicate_: predicate used to type subjects in extents with ontology classes in RDF triples -- see next paragraphs
* _parent-predicate_: predicate used to express _subClassOf_ relationships in the ontology -- see next paragraphs
* _query-prefix_: prefix of the query used during the annotation -- see next paragraphs
* _ontology-base-uri_: base URI of the ontology -- see next paragraphs
* _reduce-lattice_: boolean indicating whether the annotated lattice should be reduced to concepts with a non-empty 
reduced notations of their annotations


## SPARQL queries

Below are the SPARQL queries used in the Python scripts. The use of configuration parameters is highlighted 
with ``("parameter_used")``.

### Selection of the ontology classes associated with all the (formal) objects of the lattice 

For each object_uri appearing in the extents of the formal concepts of the lattice:

```sparql
("query-prefix")

select distinct ?class where { 
    <object_uri> ("type-predicate")/("parent-predicate")* ?class . 
    FILTER(REGEX(STR(?class), "(ontology-base-uri)", "i")) .
}
```

### Relationships between classes

For each class_uri in the ontology

```sparql
("query-prefix")

select distinct ?parent where { 
    <class_uri> ("parent-predicate") ?parent . 
    FILTER(REGEX(STR(?parent), "(ontology-base-uri)", "i")) . 
}
```

## Execution

This program can be executed with:

```shell
python latticeAnnotator.py config.json lattice.json output.csv statistics.json
```

with:

* _config.json_: path to the configuration file -- see previous paragraphs
* _lattice.json_: SOFIA lattice
* _output.csv_: contains the axioms extracted from the annotated lattice
* _statistics.json_: Name of the file where the statistics of the associated ontology and the extracted axioms will be 
stored
